(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),Chan=function(){function e(n){_classCallCheck(this,e),this.users=[],this.data={id:n}}return _createClass(e,[{key:"add",value:function(e){var n=this.users;return n.indexOf(e)<0&&(n.push(e),!0)}},{key:"remove",value:function(e){var n=this.users,r=n.indexOf(e);return r>-1&&(n.splice(r,1),!0)}},{key:"replaceUsers",value:function(e){this.users=e}}]),e}();exports.default=Chan;
},{}],2:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Parser=function(){function e(){_classCallCheck(this,e),this.onServerData=function(e){},this.onChanData=function(e,t){},this.onUserData=function(e,t){},this.onServerEvent=function(e,t){},this.onChanEvent=function(e,t,r){},this.onUserEvent=function(e,t,r){},this.onServerList=function(e){},this.onChanList=function(e){},this.onError=function(e){}}return _createClass(e,[{key:"check",value:function(e){try{var t=JSON.parse(e);this._checkMsg(t)}catch(e){this.onError(2)}}},{key:"_getTypeIdByData",value:function(e){var t=null,r=null;return Number.isInteger(e)?t=e:(t=e.y,r=e.i||null),{type:t,id:r}}},{key:"_dispatchMsg",value:function(e,t,r,n,a){var s=parseInt(e+10*t);switch(s){case 11:this.onUserEvent(r,n,a);break;case 12:this.onChanEvent(r,n,a);break;case 13:this.onServerEvent(n,a);break;case 21:this.onUserData(r,a);break;case 22:this.onChanData(r,a);break;case 23:this.onServerData(a);break;case 32:this.onChanList(a);break;case 33:this.onServerList(a);break;default:console.warn("Parser error: the combination message type: "+e+" and from type: "+t+" does'nt exist"),this.onError(2)}}},{key:"_checkMsg",value:function(e){var t=(e.type,e.from,e.label,e.target,e.msg,this._getTypeIdByData(from)),r=t.targetType;t.targetId;Number.isInteger(r)&&Number.isInteger(targetType)?r<1||r>3||targetType<1||targetType>3?(console.warn("Parser error: message type and target type must be scoped between 0 and 4"),this.onError(2)):this._dispatchMsg(r,targetType,targetId,label,msg):(console.warn("Parser error: message must have type and target type"),this.onError(2))}}]),e}();exports.default=Parser;
},{}],3:[function(require,module,exports){
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var a=n[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,r,a){return r&&e(n.prototype,r),a&&e(n,a),n}}(),MESSAGE_LIST={0:{en:"Can not connect",fr:"Connexion impossible"},1:{en:"Client undefined error ($1)",fr:"Erreur client indéfinie ($1)"},2:{en:"Data parsing stopped: transferred data incomplete",fr:"Analyse des données stoppé, données transférées incomplêtes"},3:{en:"You are connected!",fr:"Vous êtes connecté !"},4:{en:"You are disconnected!",fr:"Vous êtes déconnecté !"},5:{en:"Connection server error",fr:"Erreur de connexion avec le serveur"},101:{en:"Command label undefined ($1)",fr:"Commande indéfinie ($1)"},102:{en:"Unknown command ($1)",fr:"Commande inconnue ($1)"},201:{en:"Message to user $1 error (text or user name empty)",fr:"Erreur d'envoie de message à l'utilisateur $1 (texte ou nom d'utilisateur manquant)"},301:{en:"User not found",fr:"L'utilisateur n'a pas été trouvé"},302:{en:"You don't have permission to change chan data $1",fr:"Vous n'avez pas la permission de changer les données du salon $1"},303:{en:"You can only use alphanumeric, hyphen and underscore between 3 and 10 characters in an user name but you have write $1",fr:"Pour un nom d'utilisateur vous ne pouvez utiliser que des caractères latin standarts (minuscules, majuscules), des chiffres, des tirets et des underscores entre 3 et 10 caractères mais vous avez écris $1"},304:{en:"Name undefined",fr:"Nom indéfinis"},305:{en:"The name $1 is already used",fr:"Le nom $1 est déjà utilisé"},306:{en:"Name undefined",fr:"Nom indéfinis"},307:{en:"You can't change your role",fr:"Vous ne pouvez pas changer votre rôle"},308:{en:"A user event must have a label property ($1)",fr:"Un évênement utilisateur doit avoir une propriété 'label' ($1)"},309:{en:"You can't change the role of $1 if you are not moderator",fr:"Vous ne pouvez pas changer le role de $1 si vous n'êtes pas modérateur"},310:{en:"You don't have permission to change data $1 of $2",fr:"Vous n'avez pas la permission de changer la donnée $1 de $2"},311:{en:"You don't have permission to kick $1 from $2",fr:"Vous n'avez pas la permission d'expulser $1 du salon $2"},312:{en:"$1 is already $2",fr:"$1 est déjà $2"},401:{en:"You don't have permission to change the pass of the chan",fr:"Vous n'avez pas la permission de changer le mot de passe du salon"},402:{en:"The name $1 is already used",fr:"Le nom $1 est déjà utilisé"},403:{en:"Name undefined",fr:"Nom indéfinis"},404:{en:"You can only use alphanumeric, hyphen and underscore between 3 and 10 characters in a chan name but you have write $1",fr:"Pour un nom de salon vous ne pouvez utiliser que des caractères latin standarts (minuscules, majuscules), des chiffres, des tirets et des underscores entre 3 et 10 caractères mais vous avez écris $1"},405:{en:"A chan event must have a label property ($1)",fr:"Un évênement de salon doit avoir une propriété 'label' ($1)"},406:{en:"You can't join the chan $1",fr:"Vous n'êtes pas autorisé à rejoindre le salon $1)"},407:{en:"You can't create the chan $1",fr:"Il est impossible de créer le salon $1)"},501:{en:"$1 change his name to $2",fr:"$1 s'appele désormais $2"},502:{en:"$1 has been kicked by $2",fr:"$1 a été expulsé par $2"},503:{en:"You have been kicked by $1",fr:"Vous avez été expulsé par $1"},504:{en:"$1 leave the chan $2",fr:"$1 a quitté le salon $2"},505:{en:"$1 join the chan $2",fr:"$1 a rejoind le salon $2"}},Translate=function(){function e(n){_classCallCheck(this,e),this.lang=n}return _createClass(e,[{key:"get",value:function(e){var n=this.lang;void 0!=MESSAGE_LIST[e]&&void 0!=MESSAGE_LIST[e][n]||(e=1,data=["id: "+e]);for(var r=MESSAGE_LIST[e][n],a=arguments.length,s=Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];for(var t=s.length;--t>-1;)r=r.replace("$"+(t+1),s[t]);return r}},{key:"add",value:function(e,n){null!=MESSAGE_LIST[e]?console.warn("The error code "+e+" already exist"):MESSAGE_LIST[e]=n}}]),e}();exports.default=ErrorCode;
},{}],4:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),User=function(){function e(){_classCallCheck(this,e),this.data={},this.onDataNameChange=function(e){},this.onDataChange=function(e){},this.onLeave=function(e){}}return _createClass(e,[{key:"getRole",value:function(){return this.data.role||0}}]),e}();exports.default=User;
},{}],5:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _client=require("./client.js"),_client2=_interopRequireDefault(_client),client=new _client2.default;window.sock=client;
},{"./client.js":6}],6:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),_Chan=require("./Chan.js"),_Chan2=_interopRequireDefault(_Chan),_User=require("./User.js"),_User2=_interopRequireDefault(_User),_Translate=require("./Translate.js"),_Translate2=_interopRequireDefault(_Translate),_Parser=require("./Parser.js"),_Parser2=_interopRequireDefault(_Parser),Client=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"en";_classCallCheck(this,e),this.users=[],this.me,this.chan,this.uri=n,this.translate=new _Translate2.default(s),this.listChans=[],this.websocket,this._initDispatcher(t,a),this._initWebsocket(),this._initParser()}return _createClass(e,[{key:"_initDispatcher",value:function(e,n){var t=this;this.onConnected=e||function(e){t.onLog("User connected")},this.onError=n||function(e){console.error(e)},this.onLog=function(e){console.log(e)},this.onClose=function(e){t.onLog("Socket closed")},this.onMsgUser=function(e,n){t.onLog(e+":"+n)},this.onChanMsg=function(e,n){t.onLog(e+":"+n)},this.onServerMsg=function(e){t.onLog(e)},this.onListChan=function(e){t.onLog(e)},this.onUserEvt=function(e,n,a){t.onLog(n)},this.onChanEvt=function(e,n){t.onLog(e)},this.onServerEvt=function(e,n){t.onLog(e)},this.onChanChange=function(e){t.onLog("Chan changed")},this.onChanDataChange=function(e){t.onLog("data changed")},this.onChanUserList=function(e){t.onLog(e)}}},{key:"_initParser",value:function(){var e=this;this.parser=new _Parser2.default,this.parser.onError=function(n){e.onError(e.translate.get(n))},this.parser.onUserEvent=function(n,t,a){var s=e.getUserById(n);"msg"===t?e.onMsgUser(s.data.name,a):e.onUserEvt(s,t,a)},this.parser.onChanEvent=function(n,t,a){var s=e.getUserById(n);"msg"===t?e.onChanMsg(s.data.name,a):e.onChanEvt(t,a)},this.parser.onServerEvent=function(n,t){if("msg"===n)e.onServerMsg(t);else if("error"===n){var a;e.onServerMsg((a=e.translate).get.apply(a,[t.id].concat(_toConsumableArray(t.vars))))}else e.onServerEvt(n,t)},this.parser.onChanList=function(n){var t=[];for(var a in n){var s=e._updateUser(a,!1);t.push(s)}e.chan.replaceUsers(t),e._dispatchChanUserList()},this.parser.onServerList=function(n){e.listChans=n,e._dispatchServerChanList()},this.parser.onChanData=function(n,t){t.id=n,e._setChanData(d)},this.parser.onUserData=function(n,t){t.id=n,e._updateUser(t)},this.parser.onServerData=function(e){console.warn("No update for server data")}}},{key:"_initWebsocket",value:function(){var e=this;try{this.websocket=new WebSocket(this.uri),this.websocket.onclose=function(n){e.onClose(n.data)},this.websocket.onmessage=function(n){e.parser.check(n.data)},this.websocket.onerror=function(n){e.onError(mpgClient.trad.get(5))},window.addEventListener("beforeunload",function(n){e.close()},!1)}catch(e){this.onError(this.trad.get(0))}}},{key:"_send",value:function(e){this.websocket.send(JSON.stringify(e))}},{key:"sendMsg",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sendUserEvt("msg",e,n)}},{key:"sendUserEvt",value:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null===t?this._send({y:1,l:e,t:{y:2,i:this.chan.data.id},m:n}):this._send({y:1,l:e,t:{y:1,i:t.data.id},m:n})}},{key:"sendUserData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t={y:1,i:null===n?this.me.data.id:n.data.id};return this._send({y:2,t:t,m:e})}},{key:"sendChanEvt",value:function(e,n){return this._send({y:1,l:e,t:{y:2,i:this.chan.data.id},m:n})}},{key:"sendChanData",value:function(e){var n={y:2,i:this.chan.data.id};return this._send({y:2,t:n,m:e})}},{key:"listenChanList",value:function(e){this.onListChan=e,this.listChans=[],this._send({y:3,t:2,l:1})}},{key:"stopListenChans",value:function(){this._send({y:3,t:2,l:0}),this.onListChan=null}},{key:"joinChan",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.sendUserData({chan:{name:e,pass:n}})}},{key:"changeUserName",value:function(e,n){this.me.onDataNameChange=n,this.sendUserData({name:e})}},{key:"changeChanName",value:function(e){this.sendChanData({name:chanName})}},{key:"kickUser",value:function(e){this.sendUserData({chan:{id:-1}},e)}},{key:"upToModerator",value:function(e){this.sendUserData({role:1},e)}},{key:"close",value:function(){this.websocket.close()}},{key:"removeUser",value:function(e){this.users.indexOf(e);return userI>-1&&(this.users.splice(userI,1),this.chan.removeUser(e),!0)}},{key:"getUserByName",value:function(e){return this.users.find(function(n){return n.data.name===e})||null}},{key:"getUserById",value:function(e){return this.users.find(function(n){return n.data.id===e})||null}},{key:"_updateUser",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null==this.me)return this.me=new _User2.default,this._setUserData(e,this.me,!1),n&&this._dispatchConnected(),this.onServerMsg(this.trad.get(3)),this.me;var t=this.getUserById(e.id);return null!==t?this._setUserData(e,t):(t=new _User2.default,this._setUserData(e,t),n&&this._dispatchChanUserList()),t}},{key:"_dispatchUserDataChange",value:function(e,n){null!=e.onDataChange&&e.onDataChange(n),null!=this.onUserDataChange&&this.onUserDataChange(e,n)}},{key:"_dispatchChanUserList",value:function(){this.onChanUserList&&this.onChanUserList(this.getChanUserList())}},{key:"_dispatchServerChanList",value:function(){this.onListChan&&this.onListChan(this.listChans)}},{key:"_dispatchConnected",value:function(){this.onConnected&&this.onConnected(this.me)}},{key:"_dispatchChanChange",value:function(){this.onChanDataChange&&this.onChanDataChange(this.chan.data),this.onChanChange&&this.onChanChange(this.chan),this._dispatchChanUserList(),this._dispatchServerChanList()}},{key:"_setUserData",value:function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null!=e.id&&(n.data.id=e.id);for(var a in e)if("name"===a){var s=n.data.name;n.data.name=e.name,t&&(null!=n.onDataNameChange&&e.name!=s&&n.onDataNameChange(),null!=s&&s!=e.name&&this.onServerMsg(this.trad.get(501,[s,e.name])),this._dispatchChanUserList())}else"chan"===a?n!==this.me&&(e.chan.id!==this.chan.data.id?(this.chan.remove(n),this.onServerMsg(this.trad.get(504,[n.data.name,this.chan.data.name])),t&&this._dispatchChanUserList()):(this.chan.join(n),this.onServerMsg(this.trad.get(505,[n.data.name,this.chan.data.name])),t&&this._dispatchChanUserList())):n.data[a]=e[a];this._dispatchUserDataChange(n,e)}},{key:"_setChanData",value:function(e){var n=!1;(this.chan||this.chan.data.id!==e.id)&&(this.chan=new _Chan2.default(e.id),n=!0);for(key in e)this.chan.data[key]=e[key];n?this._dispatchChanChange():this.onChanDataChange&&this.onChanDataChange(e)}}]),e}();exports.default=Client;
},{"./Chan.js":1,"./Parser.js":2,"./Translate.js":3,"./User.js":4}]},{},[5]);
