(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),Chan=function(){function e(n){_classCallCheck(this,e),this.users=[],this.data={id:n}}return _createClass(e,[{key:"add",value:function(e){var n=this.users;return n.indexOf(e)<0&&(n.push(e),!0)}},{key:"remove",value:function(e){var n=this.users,r=n.indexOf(e);return r>-1&&(n.splice(r,1),!0)}},{key:"replaceUsers",value:function(e){this.users=e}}]),e}();exports.default=Chan;
},{}],2:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Parser=function(){function e(){_classCallCheck(this,e),this.onServerData=function(e){},this.onChanData=function(e,t){},this.onUserData=function(e,t){},this.onServerEvent=function(e,t){},this.onChanEvent=function(e,t,n){},this.onUserEvent=function(e,t,n){},this.onServerList=function(e){},this.onChanList=function(e){},this.onError=function(e){}}return _createClass(e,[{key:"check",value:function(e){try{var t=JSON.parse(e);this._checkMsg(t)}catch(t){this.onError(2),console.error(t,e)}}},{key:"_getTypeIdByData",value:function(e){var t=null,n=null;return Number.isInteger(e)?t=e:(t=e.y,n=e.i||null),{type:t,id:n}}},{key:"_dispatchMsg",value:function(e,t,n,r,a){var s=parseInt(e+10*t);switch(s){case 11:this.onUserEvent(n,r,a);break;case 12:this.onChanEvent(n,r,a);break;case 13:this.onServerEvent(r,a);break;case 21:this.onUserData(n,a);break;case 22:this.onChanData(n,a);break;case 23:this.onServerData(a);break;case 32:this.onChanList(a);break;case 33:this.onServerList(a);break;default:console.warn("Parser error: the combination message type: "+e+" and from type: "+t+" does'nt exist"),this.onError(2)}}},{key:"_checkMsg",value:function(e){var t=e.y,n=e.l,r=e.t,a=e.m,s=this._getTypeIdByData(r),o=s.type,i=s.id;Number.isInteger(t)&&Number.isInteger(o)?t<1||t>3||o<1||o>3?(console.warn("Parser error: message type and target type must be scoped between 0 and 4"),this.onError(2)):this._dispatchMsg(t,o,i,n,a):(console.warn("Parser error: message must have type and target type"),this.onError(2))}}]),e}();exports.default=Parser;
},{}],3:[function(require,module,exports){
"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,a,r){return a&&e(n.prototype,a),r&&e(n,r),n}}(),MESSAGE_LIST={0:{en:"Can not connect",fr:"Connexion impossible"},1:{en:"Client undefined error ($1)",fr:"Erreur client indéfinie ($1)"},2:{en:"Data parsing stopped: transferred data incomplete",fr:"Analyse des données stoppé, données transférées incomplêtes"},3:{en:"You are connected!",fr:"Vous êtes connecté !"},4:{en:"You are disconnected!",fr:"Vous êtes déconnecté !"},5:{en:"Connection server error",fr:"Erreur de connexion avec le serveur"},101:{en:"Command label undefined ($1)",fr:"Commande indéfinie ($1)"},102:{en:"Unknown command ($1)",fr:"Commande inconnue ($1)"},201:{en:"Message to user $1 error (text or user name empty)",fr:"Erreur d'envoie de message à l'utilisateur $1 (texte ou nom d'utilisateur manquant)"},301:{en:"User not found",fr:"L'utilisateur n'a pas été trouvé"},302:{en:"You don't have permission to change chan data $1",fr:"Vous n'avez pas la permission de changer les données du salon $1"},303:{en:"You can only use alphanumeric, hyphen and underscore between 3 and 10 characters in an user name but you have write $1",fr:"Pour un nom d'utilisateur vous ne pouvez utiliser que des caractères latin standarts (minuscules, majuscules), des chiffres, des tirets et des underscores entre 3 et 10 caractères mais vous avez écris $1"},304:{en:"Name undefined",fr:"Nom indéfinis"},305:{en:"The name $1 is already used",fr:"Le nom $1 est déjà utilisé"},306:{en:"Name undefined",fr:"Nom indéfinis"},307:{en:"You can't change your role",fr:"Vous ne pouvez pas changer votre rôle"},308:{en:"A user event must have a label property ($1)",fr:"Un évênement utilisateur doit avoir une propriété 'label' ($1)"},309:{en:"You can't change the role of $1 if you are not moderator",fr:"Vous ne pouvez pas changer le role de $1 si vous n'êtes pas modérateur"},310:{en:"You don't have permission to change data $1 of $2",fr:"Vous n'avez pas la permission de changer la donnée $1 de $2"},311:{en:"You don't have permission to kick $1 from $2",fr:"Vous n'avez pas la permission d'expulser $1 du salon $2"},312:{en:"$1 is already $2",fr:"$1 est déjà $2"},401:{en:"You don't have permission to change the pass of the chan",fr:"Vous n'avez pas la permission de changer le mot de passe du salon"},402:{en:"The name $1 is already used",fr:"Le nom $1 est déjà utilisé"},403:{en:"Name undefined",fr:"Nom indéfinis"},404:{en:"You can only use alphanumeric, hyphen and underscore between 3 and 10 characters in a chan name but you have write $1",fr:"Pour un nom de salon vous ne pouvez utiliser que des caractères latin standarts (minuscules, majuscules), des chiffres, des tirets et des underscores entre 3 et 10 caractères mais vous avez écris $1"},405:{en:"A chan event must have a label property ($1)",fr:"Un évênement de salon doit avoir une propriété 'label' ($1)"},406:{en:"You can't join the chan $1",fr:"Vous n'êtes pas autorisé à rejoindre le salon $1)"},407:{en:"You can't create the chan $1",fr:"Il est impossible de créer le salon $1)"},501:{en:"$1 change his name to $2",fr:"$1 s'appele désormais $2"},502:{en:"$1 has been kicked by $2",fr:"$1 a été expulsé par $2"},503:{en:"You have been kicked by $1",fr:"Vous avez été expulsé par $1"},504:{en:"$1 leave the chan $2",fr:"$1 a quitté le salon $2"},505:{en:"$1 join the chan $2",fr:"$1 a rejoind le salon $2"}},Translate=function(){function e(n){_classCallCheck(this,e),this.lang=n}return _createClass(e,[{key:"get",value:function(e){var n=this.lang;void 0!=MESSAGE_LIST[e]&&void 0!=MESSAGE_LIST[e][n]||(e=1,data=["id: "+e]);for(var a=MESSAGE_LIST[e][n],r=arguments.length,s=Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];for(var t=s.length;--t>-1;)a=a.replace("$"+(t+1),s[t]);return a}},{key:"add",value:function(e,n){null!=MESSAGE_LIST[e]?console.warn("The error code "+e+" already exist"):MESSAGE_LIST[e]=n}}]),e}();exports.default=Translate;
},{}],4:[function(require,module,exports){
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),User=function(){function e(){_classCallCheck(this,e),this.data={},this.onDataNameChange=function(e){},this.onDataChange=function(e){},this.onLeave=function(e){}}return _createClass(e,[{key:"getRole",value:function(){return this.data.role||0}}]),e}();exports.default=User;
},{}],5:[function(require,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _client=require("./client.js"),_client2=_interopRequireDefault(_client);window.sock=_client2.default;
},{"./client.js":6}],6:[function(require,module,exports){
"use strict";function _interopRequireDefault(n){return n&&n.__esModule?n:{default:n}}function _toConsumableArray(n){if(Array.isArray(n)){for(var e=0,t=Array(n.length);e<n.length;e++)t[e]=n[e];return t}return Array.from(n)}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_Chan=require("./Chan.js"),_Chan2=_interopRequireDefault(_Chan),_User=require("./User.js"),_User2=_interopRequireDefault(_User),_Translate=require("./Translate.js"),_Translate2=_interopRequireDefault(_Translate),_Parser=require("./Parser.js"),_Parser2=_interopRequireDefault(_Parser),Client=function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"en";_classCallCheck(this,n),console.log(e),this.users=[],this.me=null,this.chan=null,this.uri=e,this.translate=new _Translate2.default(s),this.listChans=[],this.websocket=null,this._initDispatcher(t,a),this._initWebsocket(),this._initParser()}return _createClass(n,[{key:"_initDispatcher",value:function(n,e){var t=this;this.onConnected=n||function(n){t.onLog("User connected")},this.onError=e||function(n){console.error(n)},this.onLog=function(n){console.log(n)},this.onClose=function(n){t.onLog("Socket closed")},this.onMsgUser=function(n,e){t.onLog(n+":"+e)},this.onChanMsg=function(n,e){t.onLog(n+":"+e)},this.onServerMsg=function(n){t.onLog(n)},this.onListChan=function(n){t.onLog(n)},this.onUserEvt=function(n,e,a){t.onLog(e)},this.onChanEvt=function(n,e){t.onLog(n)},this.onServerEvt=function(n,e){t.onLog(n)},this.onChanChange=function(n){t.onLog("Chan changed")},this.onChanDataChange=function(n){t.onLog("data changed")},this.onChanUserList=function(n){t.onLog(n)}}},{key:"_initParser",value:function(){var n=this;this.parser=new _Parser2.default,this.parser.onError=function(e){n.onError(n.translate.get(e))},this.parser.onUserEvent=function(e,t,a){var s=n.getUserById(e);"msg"===t?n.onMsgUser(s.data.name,a):n.onUserEvt(s,t,a)},this.parser.onChanEvent=function(e,t,a){var s=n.getUserById(e);"msg"===t?n.onChanMsg(s.data.name,a):n.onChanEvt(t,a)},this.parser.onServerEvent=function(e,t){if("msg"===e)n.onServerMsg(t);else if("error"===e){var a;n.onServerMsg((a=n.translate).get.apply(a,[t.id].concat(_toConsumableArray(t.vars))))}else n.onServerEvt(e,t)},this.parser.onChanList=function(e){var t=[];for(var a in e){var s=n._updateUser(a,!1);t.push(s)}n.chan.replaceUsers(t),n._dispatchChanUserList()},this.parser.onServerList=function(e){n.listChans=e,n._dispatchServerChanList()},this.parser.onChanData=function(e,t){t.id=e,n._setChanData(t)},this.parser.onUserData=function(e,t){t.id=e,n._updateUser(t)},this.parser.onServerData=function(n){console.warn("No update for server data")}}},{key:"_initWebsocket",value:function(){var n=this;try{this.websocket=new WebSocket(this.uri),this.websocket.onclose=function(e){n.onClose(e.data)},this.websocket.onmessage=function(e){n.parser.check(e.data)},this.websocket.onerror=function(e){n.onError(n.translate.get(5))},window.addEventListener("beforeunload",function(e){n.close()},!1)}catch(n){this.onError(this.translate.get(0)),console.error(n.message)}}},{key:"_send",value:function(n){this.websocket.send(JSON.stringify(n))}},{key:"sendMsg",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sendUserEvt("msg",n,e)}},{key:"sendUserEvt",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null===t?this._send({y:1,l:n,t:{y:2,i:this.chan.data.id},m:e}):this._send({y:1,l:n,t:{y:1,i:t.data.id},m:e})}},{key:"sendUserData",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t={y:1,i:null===e?this.me.data.id:e.data.id};return this._send({y:2,t:t,m:n})}},{key:"sendChanEvt",value:function(n,e){return this._send({y:1,l:n,t:{y:2,i:this.chan.data.id},m:e})}},{key:"sendChanData",value:function(n){var e={y:2,i:this.chan.data.id};return this._send({y:2,t:e,m:n})}},{key:"listenChanList",value:function(n){this.onListChan=n,this.listChans=[],this._send({y:3,t:2,l:1})}},{key:"stopListenChans",value:function(){this._send({y:3,t:2,l:0}),this.onListChan=null}},{key:"joinChan",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.sendUserData({chan:{name:n,pass:e}})}},{key:"changeUserName",value:function(n,e){this.me.onDataNameChange=e,this.sendUserData({name:n})}},{key:"changeChanName",value:function(n){this.sendChanData({name:chanName})}},{key:"kickUser",value:function(n){this.sendUserData({chan:{id:-1}},n)}},{key:"upToModerator",value:function(n){this.sendUserData({role:1},n)}},{key:"close",value:function(){this.websocket.close()}},{key:"removeUser",value:function(n){this.users.indexOf(n);return userI>-1&&(this.users.splice(userI,1),this.chan.removeUser(n),!0)}},{key:"getUserByName",value:function(n){return this.users.find(function(e){return e.data.name===n})||null}},{key:"getUserById",value:function(n){return this.users.find(function(e){return e.data.id===n})||null}},{key:"_updateUser",value:function(n){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null==this.me)return this.me=new _User2.default,this._setUserData(n,this.me,!1),e&&this._dispatchConnected(),this.onServerMsg(this.trad.get(3)),this.me;var t=this.getUserById(n.id);return null!==t?this._setUserData(n,t):(t=new _User2.default,this._setUserData(n,t),e&&this._dispatchChanUserList()),t}},{key:"_dispatchUserDataChange",value:function(n,e){null!=n.onDataChange&&n.onDataChange(e),null!=this.onUserDataChange&&this.onUserDataChange(n,e)}},{key:"_dispatchChanUserList",value:function(){this.onChanUserList&&this.onChanUserList(this.chan.users)}},{key:"_dispatchServerChanList",value:function(){this.onListChan&&this.onListChan(this.listChans)}},{key:"_dispatchConnected",value:function(){this.onConnected&&this.onConnected(this.me)}},{key:"_dispatchChanChange",value:function(){this.onChanDataChange&&this.onChanDataChange(this.chan.data),this.onChanChange&&this.onChanChange(this.chan),this._dispatchChanUserList(),this._dispatchServerChanList()}},{key:"_setUserData",value:function(n,e){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null!=n.id&&(e.data.id=n.id);for(var a in n)if("name"===a){var s=e.data.name;e.data.name=n.name,t&&(null!=e.onDataNameChange&&n.name!=s&&e.onDataNameChange(),null!=s&&s!=n.name&&this.onServerMsg(this.trad.get(501,[s,n.name])),this._dispatchChanUserList())}else"chan"===a?e!==this.me&&(n.chan.id!==this.chan.data.id?(this.chan.remove(e),this.onServerMsg(this.trad.get(504,[e.data.name,this.chan.data.name])),t&&this._dispatchChanUserList()):(this.chan.join(e),this.onServerMsg(this.trad.get(505,[e.data.name,this.chan.data.name])),t&&this._dispatchChanUserList())):e.data[a]=n[a];this._dispatchUserDataChange(e,n)}},{key:"_setChanData",value:function(n){var e=!1;null!=this.chan&&this.chan.data.id===n.id||(this.chan=new _Chan2.default(n.id),e=!0);for(var t in n)this.chan.data[t]=n[t];e?this._dispatchChanChange():this.onChanDataChange&&this.onChanDataChange(n)}}]),n}();exports.default=Client;
},{"./Chan.js":1,"./Parser.js":2,"./Translate.js":3,"./User.js":4}]},{},[5]);
